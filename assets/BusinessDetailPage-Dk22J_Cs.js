import{j as e}from"./vendor-markdown-BC8sZGMk.js";import{r as l,i as k,d as E}from"./vendor-react-BDu5rya1.js";import{M as S}from"./MapView-C7LNufRJ.js";import{s as D,f as R,c as f}from"./index-X6OjkqCn.js";import{u as j,s as F,N as A,b as B,v as I,k as P,w as $}from"./vendor-ui-Vsc3AOGk.js";import"./vendor-maps-Bnz1BGCy.js";import"./vendor-query-DenH8THg.js";function N({businessId:d,onSuccess:m}){const[s,b]=l.useState(0),[t,x]=l.useState(0),[c,g]=l.useState(""),[o,u]=l.useState(""),[a,r]=l.useState(!1),[i,h]=l.useState(""),[y,v]=l.useState(!1),w=async n=>{if(n.preventDefault(),h(""),v(!1),!o.trim()){h("Please enter your name");return}if(s===0){h("Please select a star rating");return}if(c.trim().length<10){h("Review must be at least 10 characters long");return}r(!0);try{const{error:p}=await D.from("reviews").insert({business_id:d,author_name:o.trim(),rating:s,comment:c.trim()});if(p)throw p;v(!0),b(0),g(""),u(""),m&&m(),setTimeout(()=>v(!1),5e3)}catch(p){console.error("Error submitting review:",p),h("Failed to submit review. Please try again.")}finally{r(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Write a Review"}),y&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-800 font-medium",children:"âœ… Thank you! Your review has been submitted successfully."})}),i&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-800 font-medium",children:["âŒ ",i]})}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"authorName",className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"authorName",value:o,onChange:n=>u(n.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your name",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Rating ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[[1,2,3,4,5].map(n=>e.jsx("button",{type:"button",onClick:()=>b(n),onMouseEnter:()=>x(n),onMouseLeave:()=>x(0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded transition-transform hover:scale-110",children:e.jsx(j,{size:32,className:`transition-colors ${n<=(t||s)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},n)),s>0&&e.jsxs("span",{className:"ml-2 text-gray-600 self-center font-medium",children:[s," ",s===1?"star":"stars"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Review ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"comment",value:c,onChange:n=>g(n.target.value),rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Share your experience with this dealership...",required:!0}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[c.length," characters (minimum 10)"]})]}),e.jsx("button",{type:"submit",disabled:a,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md hover:shadow-lg",children:a?"Submitting...":"Submit Review"})]})]})}function V(){const{id:d}=k(),m=E(),[s,b]=l.useState(null),[t,x]=l.useState([]),[c,g]=l.useState(!0);l.useEffect(()=>{async function a(){if(d)try{const[r,i]=await Promise.all([R(d),f(d)]);b(r),x(i)}catch(r){console.error("Error loading business:",r)}finally{g(!1)}}a()},[d]);const o=async()=>{if(d)try{const a=await f(d);x(a)}catch(a){console.error("Error refreshing reviews:",a)}};if(c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx("p",{className:"text-[var(--brand-dark)]",children:"Loading business..."})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-4",children:"Business not found"}),e.jsx("button",{onClick:()=>m("/"),className:"bg-[var(--brand-primary)] text-white px-5 py-2 rounded-lg hover:bg-[var(--brand-dark)] transition",children:"Back Home"})]})});const u=t.length>0?t.reduce((a,r)=>a+(r.rating||0),0)/t.length:0;return e.jsx("div",{className:"min-h-screen bg-[var(--brand-bg)] pt-28 pb-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>m(-1),className:"flex items-center gap-2 text-[var(--brand-primary)] hover:text-[var(--brand-dark)] mb-6 font-medium",children:[e.jsx(F,{className:"w-4 h-4"}),"Back"]}),s.featured?e.jsxs("div",{className:"bg-[var(--brand-primary)] bg-opacity-95 rounded-xl p-8 shadow-xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[s.imageUrl&&e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-64 object-cover",onError:a=>{a.currentTarget.style.display="none"}})}),s.latitude&&s.longitude&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx(S,{center:[s.latitude,s.longitude],zoom:15,height:"h-64",markers:[{position:[s.latitude,s.longitude],title:s.name,description:s.address||void 0}]}),e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.latitude},${s.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-4 right-4 bg-[var(--brand-gold)] text-[var(--brand-dark)] px-4 py-2 rounded-lg shadow-lg hover:bg-yellow-400 transition flex items-center gap-2 text-sm font-semibold z-[1000]",children:[e.jsx(A,{className:"w-4 h-4"}),"Get Directions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsx("span",{className:"bg-[var(--brand-gold)] text-[var(--brand-dark)] px-3 py-1 rounded-full text-sm font-bold",children:"â­ FEATURED"}),s.verified&&e.jsx("span",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"âœ“ VERIFIED"}),s.englishFluency&&e.jsxs("span",{className:"bg-white/20 text-white px-3 py-1 rounded-full text-xs font-semibold uppercase",children:[s.englishFluency," English"]})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:s.name}),e.jsx("p",{className:"text-white opacity-90 mb-4 text-lg",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-white mb-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ“ Location:"})," ",s.location]}),s.address&&e.jsx("p",{className:"ml-5 opacity-80",children:s.address}),s.baseDistance&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸš— Distance:"})," ",s.baseDistance]})]}),e.jsxs("div",{children:[s.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ“ž Phone:"})," ",e.jsx("a",{href:`tel:${s.phone}`,className:"underline hover:text-[var(--brand-gold)]",children:s.phone})]}),s.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"âœ‰ï¸ Email:"})," ",e.jsx("a",{href:`mailto:${s.email}`,className:"underline hover:text-[var(--brand-gold)] break-all",children:s.email})]}),s.website&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸŒ Website:"})," ",e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-[var(--brand-gold)] break-all",children:"Visit Site"})]})]})]}),s.notes&&e.jsx("div",{className:"bg-white/10 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-white text-sm",children:[e.jsx("strong",{children:"ðŸ’¡ Insider Tip:"})," ",s.notes]})}),e.jsxs("div",{id:"reviews",className:"border-t border-white/20 pt-6 mt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Reviews from Military Families"}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(a=>e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-semibold text-white",children:a.authorName}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((r,i)=>e.jsx(j,{className:`w-4 h-4 ${i<(a.rating||0)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},i))})]}),a.comment&&e.jsx("p",{className:"text-white opacity-90",children:a.comment}),a.createdAt&&e.jsx("p",{className:"text-xs text-white opacity-60 mt-2",children:new Date(a.createdAt).toLocaleDateString()})]},a.id))}):e.jsx("p",{className:"text-white opacity-80",children:"No reviews yet. Be the first to review!"}),e.jsx("div",{className:"mt-8",children:e.jsx(N,{businessId:s.id,onSuccess:o})})]})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[s.imageUrl&&e.jsx("div",{className:"w-full h-64 bg-gray-100",children:e.jsx("img",{src:s.imageUrl,alt:s.name??"Business",className:"w-full h-64 object-cover",onError:a=>{a.currentTarget.parentElement.style.display="none"}})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--brand-dark)] mb-2",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.verified&&e.jsx("span",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"âœ“ VERIFIED"})})]}),t.length>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((a,r)=>e.jsx(j,{className:`w-5 h-5 ${r<Math.round(u)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},r))}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.length," reviews"]})]})]}),e.jsx("p",{className:"text-[var(--brand-dark)] opacity-80 mb-6 text-lg",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Location"}),e.jsx("p",{className:"text-gray-600",children:s.location}),s.address&&e.jsx("p",{className:"text-sm text-gray-500",children:s.address}),s.baseDistance&&e.jsx("p",{className:"text-sm text-[var(--brand-primary)]",children:s.baseDistance})]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Phone"}),e.jsx("a",{href:`tel:${s.phone}`,className:"text-[var(--brand-primary)] hover:underline",children:s.phone})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Email"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-[var(--brand-primary)] hover:underline break-all",children:s.email})]})]}),s.website&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--brand-primary)] hover:underline break-all",children:"Visit Website"})]})]}),s.englishFluency&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"English Fluency"}),e.jsx("p",{className:"text-gray-600 capitalize",children:s.englishFluency})]})]})]}),s.notes&&e.jsx("div",{className:"bg-[var(--brand-bg)] rounded-lg p-4 mb-8",children:e.jsxs("p",{className:"text-sm text-[var(--brand-dark)] opacity-80",children:[e.jsx("strong",{children:"ðŸ’¡ Insider Tip:"})," ",s.notes]})}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-6",children:"Reviews from Military Families"}),t.length>0?e.jsx("div",{className:"space-y-4",children:t.map(a=>e.jsxs("div",{className:"bg-[var(--brand-bg)] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:a.authorName}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((r,i)=>e.jsx(j,{className:`w-4 h-4 ${i<(a.rating||0)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},i))})]}),a.comment&&e.jsx("p",{className:"text-[var(--brand-dark)] opacity-80",children:a.comment}),a.createdAt&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(a.createdAt).toLocaleDateString()})]},a.id))}):e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review!"}),e.jsx("div",{className:"mt-8",children:e.jsx(N,{businessId:s.id,onSuccess:o})})]})]})]})]})})}export{V as default};
