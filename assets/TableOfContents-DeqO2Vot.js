import{s as g}from"./index-D3zTICcn.js";import{j as d}from"./vendor-query-pEaCC0W1.js";import{r as f}from"./vendor-react-DsIc-_p2.js";function w(t){const e=t,n=t;if(typeof n.tags=="string")try{const r=n.tags.trim();r.startsWith("{")&&r.endsWith("}")?e.tags=r.slice(1,-1).split(",").map(a=>a.trim().replace(/^"|"$/g,"")).filter(Boolean):e.tags=JSON.parse(r)}catch{console.warn("Could not parse tags string, defaulting to empty array:",n.tags),e.tags=[]}else Array.isArray(n.tags)||(e.tags=[]);return e}async function _(t){let e=g.from("articles").select("*").order("created_at",{ascending:!1});t?.category&&(e=e.eq("category",t.category)),t?.destination&&(e=e.eq("destination_name",t.destination)),t?.tag&&(e=e.contains("tags",[t.tag])),t?.published!==void 0&&(e=e.eq("published",t.published)),t?.limit&&(e=e.limit(t.limit)),t?.offset&&(e=e.range(t.offset,t.offset+(t.limit||10)-1));const{data:n,error:r}=await e;if(r)throw console.error("Error fetching articles:",r),r;return n.map(w)}async function A(t){const{data:e,error:n}=await g.from("articles").select("*").eq("slug",t).eq("published",!0).single();if(n){if(n.code==="PGRST116")return null;throw console.error("Error fetching article:",n),n}const r=w(e);return q(r.id),r}async function q(t){try{await g.rpc("increment_article_views",{article_id:t})}catch(e){console.warn("RPC increment_article_views failed, using fallback:",e.message);const{data:r}=await g.from("articles").select("view_count").eq("id",t).single();r&&await g.from("articles").update({view_count:r.view_count+1}).eq("id",t).select()}}async function R(t,e,n,r=3){let a=g.from("articles").select("*").eq("published",!0).neq("id",t).limit(r);e&&(a=a.eq("category",e));const{data:m,error:c}=await a;if(c)throw console.error("Error fetching related articles:",c),c;return m.map(w)}function E(t){return t.toLowerCase().replace(/[\u{1F300}-\u{1FAFF}]/gu,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-")}function j({content:t}){const[e,n]=f.useState([]),[r,a]=f.useState(""),m=f.useRef(!1),c=f.useRef(void 0);f.useEffect(()=>{const o=document.querySelector("article .prose");if(!o)return;const i=Array.from(o.querySelectorAll("h2, h3")),s=new Set,h=[];i.forEach(u=>{const x=u.tagName==="H2"?2:3,p=u.textContent?.trim()??"";if(!p)return;let l=u.id;if(!l){const y=E(p);l=y;let v=1;for(;s.has(l);)l=`${y}-${v++}`;u.id=l}s.add(l),h.push({id:l,text:p,level:x})}),n(h)},[t]),f.useEffect(()=>{if(e.length===0)return;const o=new IntersectionObserver(i=>{m.current||i.forEach(s=>{s.isIntersecting&&a(s.target.id)})},{rootMargin:"-96px 0px -70% 0px",threshold:.1});return e.forEach(i=>{const s=document.getElementById(i.id);s&&o.observe(s)}),()=>o.disconnect()},[e]);const b=o=>{const i=document.getElementById(o);if(!i)return;a(o),m.current=!0,c.current&&clearTimeout(c.current);const u=i.getBoundingClientRect().top+window.pageYOffset-80;window.scrollTo({top:u,behavior:"smooth"}),c.current=window.setTimeout(()=>{m.current=!1},1e3)};return e.length===0?null:d.jsxs("div",{className:`
    hidden lg:block
    fixed
    top-1/2
    right-4
    -translate-y-1/2
    w-72
    bg-white
    rounded-lg
    shadow-lg
    p-4
    max-h-[calc(100vh-8rem)]
    overflow-y-auto
    border border-gray-200
    z-40
  `,children:[d.jsx("h3",{className:"text-lg font-bold text-[var(--brand-dark)] mb-3",children:"Table of Contents"}),d.jsx("nav",{children:d.jsx("ul",{className:"space-y-2",children:e.map(o=>d.jsx("li",{className:o.level===3?"ml-4":"",children:d.jsx("button",{onClick:()=>b(o.id),className:`text-left w-full text-sm transition-colors hover:text-[var(--brand-primary)] ${r===o.id?"text-[var(--brand-primary)] font-semibold":"text-[var(--brand-dark)] opacity-70"}`,children:o.text})},o.id))})})]})}export{j as T,R as a,_ as b,A as g};
