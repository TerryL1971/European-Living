import{s as i}from"./index-Bzn5Xp6o.js";function o(e){const t=e,r=e;if(typeof r.tags=="string")try{const a=r.tags.trim();a.startsWith("{")&&a.endsWith("}")?t.tags=a.slice(1,-1).split(",").map(s=>s.trim().replace(/^"|"$/g,"")).filter(Boolean):t.tags=JSON.parse(a)}catch{console.warn("Could not parse tags string, defaulting to empty array:",r.tags),t.tags=[]}else Array.isArray(r.tags)||(t.tags=[]);return t}async function u(e){let t=i.from("articles").select("*").order("created_at",{ascending:!1});e?.category&&(t=t.eq("category",e.category)),e?.destination&&(t=t.eq("destination_name",e.destination)),e?.tag&&(t=t.contains("tags",[e.tag])),e?.published!==void 0&&(t=t.eq("published",e.published)),e?.limit&&(t=t.limit(e.limit)),e?.offset&&(t=t.range(e.offset,e.offset+(e.limit||10)-1));const{data:r,error:a}=await t;if(a)throw console.error("Error fetching articles:",a),a;return r.map(o)}async function f(e){const{data:t,error:r}=await i.from("articles").select("*").eq("slug",e).eq("published",!0).single();if(r){if(r.code==="PGRST116")return null;throw console.error("Error fetching article:",r),r}const a=o(t);return l(a.id),a}async function l(e){try{await i.rpc("increment_article_views",{article_id:e})}catch(t){console.warn("RPC increment_article_views failed, using fallback:",t.message);const{data:a}=await i.from("articles").select("view_count").eq("id",e).single();a&&await i.from("articles").update({view_count:a.view_count+1}).eq("id",e).select()}}async function d(e,t,r,a=3){let s=i.from("articles").select("*").eq("published",!0).neq("id",e).limit(a);t&&(s=s.eq("category",t));const{data:c,error:n}=await s;if(n)throw console.error("Error fetching related articles:",n),n;return c.map(o)}export{d as a,u as b,f as g};
