import{j as e}from"./vendor-query-pEaCC0W1.js";import{r as h,L as m,h as N,u as k}from"./vendor-react-DsIc-_p2.js";import{s as S,u as B,b as E,L as R,f as j}from"./index-DAoyNcWz.js";import{B as $,E as L,g as D,a as M}from"./ErrorMessage-CkK4g-aL.js";import{M as C}from"./MapView-eVfJLFRE.js";import{e as F,c as U,v as P,w as O,N as T,s as z}from"./vendor-ui-CujC0nkv.js";import"./vendor-maps-DVEUCVjI.js";function A({business:t,featured:n=!1}){const[s,o]=h.useState(null),[p,g]=h.useState(!0),[v,d]=h.useState(!1);h.useEffect(()=>{async function c(){try{const{data:a,error:r}=await S.from("reviews").select("rating").eq("business_id",t.id);if(r)console.error("Error fetching reviews:",r),o(null);else if(a&&a.length>0){const l=a.reduce((b,y)=>b+y.rating,0)/a.length;o({avgRating:l,count:a.length})}else o({avgRating:0,count:0})}catch(a){console.error("Error fetching reviews:",a),o(null)}finally{g(!1)}}c()},[t.id]);const x=t.latitude&&t.longitude?`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`:t.address?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t.address)}`:null,i=t.latitude&&t.longitude;return e.jsxs("div",{className:`bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow overflow-hidden ${n?"border-2 border-[var(--brand-gold)]":"border border-gray-200"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{imageUrl:t.imageUrl,category:t.category,businessName:t.name,className:"w-full h-48"}),n&&e.jsx("div",{className:"absolute top-3 right-3 bg-[var(--brand-gold)] text-[var(--brand-dark)] px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"⭐ FEATURED"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[t.verified&&e.jsx("span",{className:"bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold",children:"✓ VERIFIED"}),t.englishFluency&&e.jsxs("span",{className:"bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-semibold uppercase",children:[t.englishFluency," English"]})]}),e.jsx("h3",{className:"text-xl font-bold text-[var(--brand-dark)] mb-2",children:t.name}),!p&&s&&e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative",onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:[e.jsx(m,{to:`/businesses/${t.id}`,className:"flex items-center gap-1 hover:opacity-80 transition-opacity",title:`${s.avgRating.toFixed(1)} out of 5 stars`,children:[...Array(5)].map((c,a)=>e.jsx(F,{className:`w-4 h-4 ${a<Math.round(s.avgRating)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},a))}),v&&s.count>0&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl p-4 z-50 w-64",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:[s.avgRating.toFixed(1)," out of 5 stars"]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[s.count," ",s.count===1?"rating":"ratings"]}),e.jsx(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline text-sm font-medium",children:"See all reviews →"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:s.count>0?s.avgRating.toFixed(1):"0.0"}),s.count>0?e.jsxs(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline",children:["(",s.count," ",s.count===1?"review":"reviews",")"]}):e.jsx(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline",children:"(Be the first to review!)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 mb-3 text-sm text-gray-600",children:[e.jsx(U,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.location}),t.baseDistance&&e.jsx("p",{className:"text-[var(--brand-primary)] text-xs",children:t.baseDistance})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[t.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-[var(--brand-primary)]"}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-[var(--brand-primary)] hover:underline",children:t.phone})]}),t.website&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-[var(--brand-primary)]"}),e.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--brand-primary)] hover:underline truncate",children:"Visit Website"})]})]}),i&&e.jsx("div",{className:"rounded-lg overflow-hidden mb-4",children:e.jsx(C,{center:[t.latitude,t.longitude],zoom:14,height:"h-40",markers:[{position:[t.latitude,t.longitude],title:t.name}]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{to:`/businesses/${t.id}`,className:"flex-1 text-center bg-[var(--brand-primary)] text-white py-2 px-4 rounded-lg hover:bg-[var(--brand-dark)] transition font-semibold text-sm",children:"View Details"}),x&&e.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"bg-[var(--brand-gold)] text-[var(--brand-dark)] p-2 rounded-lg hover:bg-yellow-400 transition",title:"Get Directions",children:e.jsx(T,{className:"w-5 h-5"})})]})]})]})}const V={automotive:"Automotive Services",healthcare:"Healthcare",restaurants:"Restaurants & Dining",shopping:"Shopping","home-services":"Home Services","real-estate":"Real Estate",legal:"Legal Services",education:"Education",business:"Business Services"},u={automotive:["car-dealerships","mechanics","inspection-stations","auto-parts"],healthcare:["general-practitioners","dentists","specialists","pharmacies","veterinary-services"],restaurants:["american-food","international","cafes"]};function Y(){const{selectedBase:t}=B(),{category:n}=N(),s=k(),{data:o=[],isLoading:p,error:g,refetch:v}=E(),d=h.useMemo(()=>{if(!n||!o.length)return[];const a=t||"all";return o.filter(r=>r.category===n&&(a==="all"||r.basesServed?.includes(a)))},[o,n,t]);if(p)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx(R,{size:"lg",message:"Loading businesses..."})});if(g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx(L,{title:"Failed to load businesses",message:g.message,onRetry:()=>v(),fullScreen:!0})});const f=n&&V[n]||"Services",x=D(t),i={};d.forEach(a=>{const r=a.subcategory||"other";i[r]||(i[r]=[]),i[r].push(a)}),Object.keys(i).forEach(a=>{i[a].sort((r,l)=>r.featured&&!l.featured?-1:!r.featured&&l.featured?1:r.name.localeCompare(l.name))});const c=n&&u[n]?[...u[n],...Object.keys(i).filter(a=>!u[n].includes(a)).sort()]:Object.keys(i).sort();return e.jsxs("div",{className:"min-h-screen bg-[var(--brand-bg)]",children:[e.jsx("div",{className:"bg-[var(--brand-primary)] py-4 sticky top-16 z-50 shadow-md",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx(M,{})})}),e.jsx("div",{className:"py-12 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>s("/",{state:{scrollTo:"services"}}),className:"flex items-center gap-2 text-[var(--brand-primary)] hover:text-[var(--brand-dark)] mb-8 font-medium mt-8",children:[e.jsx(z,{className:"w-4 h-4"}),"Back to All Services"]}),e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-[var(--brand-dark)] mb-4",children:f}),e.jsxs("p",{className:"text-lg text-[var(--brand-dark)] opacity-80",children:[d.length," ",d.length===1?"business":"businesses"," ","near ",x?.name||"your base"]})]}),c.filter(a=>i[a]?.length>0).length>1&&e.jsx("div",{className:"sticky top-[72px] z-30 bg-white/95 backdrop-blur-sm border-y border-gray-200 -mx-4 px-4 py-4 mb-8 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--brand-dark)] whitespace-nowrap mr-2",children:"Jump to:"}),c.map(a=>{const r=i[a];return!r||r.length===0?null:e.jsxs("button",{onClick:()=>{const l=document.getElementById(`subcategory-${a}`);if(l){const w=l.getBoundingClientRect().top+window.pageYOffset-150;window.scrollTo({top:w,behavior:"smooth"})}},className:"bg-[var(--brand-primary)] text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-[var(--brand-dark)] transition whitespace-nowrap flex-shrink-0",children:[j(a),e.jsxs("span",{className:"ml-1.5 opacity-75",children:["(",r.length,")"]})]},a)})]})}),c.length>0?e.jsx("div",{className:"space-y-12",children:c.map(a=>{const r=i[a];return!r||r.length===0?null:e.jsxs("div",{id:`subcategory-${a}`,children:[(a!=="other"||c.length>1)&&e.jsx("h2",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-6 border-b-2 border-[var(--brand-primary)] pb-2",children:j(a)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(l=>e.jsx(A,{business:l,featured:l.featured||!1},l.id))})]},a)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-[var(--brand-dark)] opacity-60 mb-4",children:["No businesses found in this category yet for ",x?.name,"."]}),e.jsx(m,{to:"/",className:"inline-block bg-[var(--brand-primary)] text-white px-6 py-3 rounded-lg hover:bg-[var(--brand-dark)] transition font-semibold",children:"Browse Other Categories"})]})]})})]})}export{Y as default};
