import{j as e}from"./vendor-markdown-CsK2p4zB.js";import{r as d,i as E,u as S}from"./vendor-react-vjDAwYPo.js";import{M as R}from"./MapView-DE3wNC9b.js";import{s as v,m as D,a as F}from"./index-BT85RCp4.js";import{e as j,q as B,N as I,c as P,P as A,n as _,t as $}from"./vendor-ui-D1n4FJf4.js";import"./vendor-maps-BByuTyFs.js";import"./vendor-query-DBXCnbMX.js";function N({businessId:i,onSuccess:a}){const[s,u]=d.useState(0),[l,x]=d.useState(0),[o,b]=d.useState(""),[m,g]=d.useState(""),[r,t]=d.useState(!1),[n,h]=d.useState(""),[w,f]=d.useState(!1),k=async c=>{if(c.preventDefault(),h(""),f(!1),!m.trim()){h("Please enter your name");return}if(s===0){h("Please select a star rating");return}if(o.trim().length<10){h("Review must be at least 10 characters long");return}t(!0);try{const{error:p}=await v.from("reviews").insert({business_id:i,author_name:m.trim(),rating:s,comment:o.trim()});if(p)throw p;f(!0),u(0),b(""),g(""),a&&a(),setTimeout(()=>f(!1),5e3)}catch(p){console.error("Error submitting review:",p),h("Failed to submit review. Please try again.")}finally{t(!1)}};return e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Write a Review"}),w&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsx("p",{className:"text-green-800 font-medium",children:"âœ… Thank you! Your review has been submitted successfully."})}),n&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-800 font-medium",children:["âŒ ",n]})}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"authorName",className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Name ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"authorName",value:m,onChange:c=>g(c.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Enter your name",maxLength:100,required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Rating ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",onClick:()=>u(c),onMouseEnter:()=>x(c),onMouseLeave:()=>x(0),className:"focus:outline-none focus:ring-2 focus:ring-blue-500 rounded transition-transform hover:scale-110",children:e.jsx(j,{size:32,className:`transition-colors ${c<=(l||s)?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},c)),s>0&&e.jsxs("span",{className:"ml-2 text-gray-600 self-center font-medium",children:[s," ",s===1?"star":"stars"]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"comment",className:"block text-sm font-medium text-gray-700 mb-2",children:["Your Review ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"comment",value:o,onChange:c=>b(c.target.value),rows:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"Share your experience with this dealership...",required:!0}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:[o.length," characters (minimum 10)"]})]}),e.jsx("button",{type:"submit",disabled:r,className:"w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md hover:shadow-lg",children:r?"Submitting...":"Submit Review"})]})]})}async function L(i){try{const{data:a,error:s}=await v.from("businesses").select("*").eq("id",i).single();if(s)throw console.error("Error fetching business:",s),s;return a?D(a):null}catch(a){return console.error("Failed to fetch business:",a),null}}async function y(i){try{const{data:a,error:s}=await v.from("reviews").select("*").eq("business_id",i).order("created_at",{ascending:!1});if(s)throw console.error("Error fetching reviews:",s),s;return(a||[]).map(F)}catch(a){return console.error("Failed to fetch reviews:",a),[]}}function W(){const{id:i}=E(),a=S(),[s,u]=d.useState(null),[l,x]=d.useState([]),[o,b]=d.useState(!0);d.useEffect(()=>{async function r(){if(i)try{const[t,n]=await Promise.all([L(i),y(i)]);console.log("Business ID:",i),console.log("Business data:",t),console.log("Reviews:",n),u(t),x(n)}catch(t){console.error("Error loading business:",t)}finally{b(!1)}}r()},[i]);const m=async()=>{if(i)try{const r=await y(i);x(r)}catch(r){console.error("Error refreshing reviews:",r)}};if(o)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx("p",{className:"text-[var(--brand-dark)]",children:"Loading business..."})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-4",children:"Business not found"}),e.jsx("button",{onClick:()=>a("/"),className:"bg-[var(--brand-primary)] text-white px-5 py-2 rounded-lg hover:bg-[var(--brand-dark)] transition",children:"Back Home"})]})});const g=l.length>0?l.reduce((r,t)=>r+(t.rating||0),0)/l.length:0;return e.jsx("div",{className:"min-h-screen bg-[var(--brand-bg)] pt-28 pb-12 px-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:()=>a(-1),className:"flex items-center gap-2 text-[var(--brand-primary)] hover:text-[var(--brand-dark)] mb-6 font-medium",children:[e.jsx(B,{className:"w-4 h-4"}),"Back"]}),s.featured?e.jsxs("div",{className:"bg-[var(--brand-primary)] bg-opacity-95 rounded-xl p-8 shadow-xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[s.imageUrl&&e.jsx("div",{className:"rounded-lg overflow-hidden",children:e.jsx("img",{src:s.imageUrl,alt:s.name,className:"w-full h-64 object-cover",onError:r=>{r.currentTarget.style.display="none"}})}),s.latitude&&s.longitude&&e.jsxs("div",{className:"relative rounded-lg overflow-hidden",children:[e.jsx(R,{center:[s.latitude,s.longitude],zoom:15,height:"h-64",markers:[{position:[s.latitude,s.longitude],title:s.name,description:s.address||void 0}]}),e.jsxs("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${s.latitude},${s.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-4 right-4 bg-[var(--brand-gold)] text-[var(--brand-dark)] px-4 py-2 rounded-lg shadow-lg hover:bg-yellow-400 transition flex items-center gap-2 text-sm font-semibold z-[1000]",children:[e.jsx(I,{className:"w-4 h-4"}),"Get Directions"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-4 flex-wrap",children:[e.jsx("span",{className:"bg-[var(--brand-gold)] text-[var(--brand-dark)] px-3 py-1 rounded-full text-sm font-bold",children:"â­ FEATURED"}),s.verified&&e.jsx("span",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"âœ“ VERIFIED"}),s.englishFluency&&e.jsxs("span",{className:"bg-white/20 text-white px-3 py-1 rounded-full text-xs font-semibold uppercase",children:[s.englishFluency," English"]})]}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:s.name}),e.jsx("p",{className:"text-white opacity-90 mb-4 text-lg",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-white mb-4",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ“ Location:"})," ",s.location]}),s.address&&e.jsx("p",{className:"ml-5 opacity-80",children:s.address}),s.baseDistance&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸš— Distance:"})," ",s.baseDistance]})]}),e.jsxs("div",{children:[s.phone&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸ“ž Phone:"})," ",e.jsx("a",{href:`tel:${s.phone}`,className:"underline hover:text-[var(--brand-gold)]",children:s.phone})]}),s.email&&e.jsxs("p",{children:[e.jsx("strong",{children:"âœ‰ï¸ Email:"})," ",e.jsx("a",{href:`mailto:${s.email}`,className:"underline hover:text-[var(--brand-gold)] break-all",children:s.email})]}),s.website&&e.jsxs("p",{children:[e.jsx("strong",{children:"ðŸŒ Website:"})," ",e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-[var(--brand-gold)] break-all",children:"Visit Site"})]})]})]}),s.notes&&e.jsx("div",{className:"bg-white/10 rounded-lg p-4 mb-4",children:e.jsxs("p",{className:"text-white text-sm",children:[e.jsx("strong",{children:"ðŸ’¡ Insider Tip:"})," ",s.notes]})}),e.jsxs("div",{id:"reviews",className:"border-t border-white/20 pt-6 mt-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-6",children:"Reviews from Military Families"}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(r=>e.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-semibold text-white",children:r.authorName}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((t,n)=>e.jsx(j,{className:`w-4 h-4 ${n<(r.rating||0)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},n))})]}),r.comment&&e.jsx("p",{className:"text-white opacity-90",children:r.comment}),r.createdAt&&e.jsx("p",{className:"text-xs text-white opacity-60 mt-2",children:new Date(r.createdAt).toLocaleDateString()})]},r.id))}):e.jsx("p",{className:"text-white opacity-80",children:"No reviews yet. Be the first to review!"}),e.jsx("div",{className:"mt-8",children:e.jsx(N,{businessId:s.id,onSuccess:m})})]})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden",children:[s.imageUrl&&e.jsx("div",{className:"w-full h-64 bg-gray-100",children:e.jsx("img",{src:s.imageUrl,alt:s.name??"Business",className:"w-full h-64 object-cover",onError:r=>{r.currentTarget.parentElement.style.display="none"}})}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-[var(--brand-dark)] mb-2",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mb-2",children:s.verified&&e.jsx("span",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-xs font-semibold",children:"âœ“ VERIFIED"})})]}),l.length>0&&e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((r,t)=>e.jsx(j,{className:`w-5 h-5 ${t<Math.round(g)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},t))}),e.jsxs("p",{className:"text-sm text-gray-600",children:[l.length," reviews"]})]})]}),e.jsx("p",{className:"text-[var(--brand-dark)] opacity-80 mb-6 text-lg",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Location"}),e.jsx("p",{className:"text-gray-600",children:s.location}),s.address&&e.jsx("p",{className:"text-sm text-gray-500",children:s.address}),s.baseDistance&&e.jsx("p",{className:"text-sm text-[var(--brand-primary)]",children:s.baseDistance})]})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Phone"}),e.jsx("a",{href:`tel:${s.phone}`,className:"text-[var(--brand-primary)] hover:underline",children:s.phone})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[s.email&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Email"}),e.jsx("a",{href:`mailto:${s.email}`,className:"text-[var(--brand-primary)] hover:underline break-all",children:s.email})]})]}),s.website&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($,{className:"w-5 h-5 text-[var(--brand-primary)]"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"Website"}),e.jsx("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--brand-primary)] hover:underline break-all",children:"Visit Website"})]})]}),s.englishFluency&&e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:"English Fluency"}),e.jsx("p",{className:"text-gray-600 capitalize",children:s.englishFluency})]})]})]}),s.notes&&e.jsx("div",{className:"bg-[var(--brand-bg)] rounded-lg p-4 mb-8",children:e.jsxs("p",{className:"text-sm text-[var(--brand-dark)] opacity-80",children:[e.jsx("strong",{children:"ðŸ’¡ Insider Tip:"})," ",s.notes]})}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-6",children:"Reviews from Military Families"}),l.length>0?e.jsx("div",{className:"space-y-4",children:l.map(r=>e.jsxs("div",{className:"bg-[var(--brand-bg)] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-semibold text-[var(--brand-dark)]",children:r.authorName}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((t,n)=>e.jsx(j,{className:`w-4 h-4 ${n<(r.rating||0)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},n))})]}),r.comment&&e.jsx("p",{className:"text-[var(--brand-dark)] opacity-80",children:r.comment}),r.createdAt&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:new Date(r.createdAt).toLocaleDateString()})]},r.id))}):e.jsx("p",{className:"text-gray-600",children:"No reviews yet. Be the first to review!"}),e.jsx("div",{className:"mt-8",children:e.jsx(N,{businessId:s.id,onSuccess:m})})]})]})]})]})})}export{W as default};
