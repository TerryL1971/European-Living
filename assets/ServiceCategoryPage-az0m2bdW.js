import{j as e}from"./vendor-markdown-BC8sZGMk.js";import{r as h,L as m,i as N,d as k}from"./vendor-react-BDu5rya1.js";import{s as S,u as B,b as E,L as R,c as j}from"./index-DQ5WlURG.js";import{B as $,E as L,g as D,a as M}from"./ErrorMessage-D40d-DWi.js";import{M as C}from"./MapView-C7LNufRJ.js";import{t as F,p as U,u as P,v as O,N as T,q as z}from"./vendor-ui-Cu_3UCVp.js";import"./vendor-query-DenH8THg.js";import"./vendor-maps-Bnz1BGCy.js";function A({business:t,featured:i=!1}){const[s,o]=h.useState(null),[p,g]=h.useState(!0),[v,c]=h.useState(!1);h.useEffect(()=>{async function d(){try{const{data:r,error:a}=await S.from("reviews").select("rating").eq("business_id",t.id);if(a)console.error("Error fetching reviews:",a),o(null);else if(r&&r.length>0){const l=r.reduce((b,y)=>b+y.rating,0)/r.length;o({avgRating:l,count:r.length})}else o({avgRating:0,count:0})}catch(r){console.error("Error fetching reviews:",r),o(null)}finally{g(!1)}}d()},[t.id]);const x=t.latitude&&t.longitude?`https://www.google.com/maps/dir/?api=1&destination=${t.latitude},${t.longitude}`:t.address?`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(t.address)}`:null,n=t.latitude&&t.longitude;return e.jsxs("div",{className:`bg-white rounded-lg shadow-md hover:shadow-xl transition-shadow overflow-hidden ${i?"border-2 border-[var(--brand-gold)]":"border border-gray-200"}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx($,{imageUrl:t.imageUrl,category:t.category,businessName:t.name,className:"w-full h-48"}),i&&e.jsx("div",{className:"absolute top-3 right-3 bg-[var(--brand-gold)] text-[var(--brand-dark)] px-3 py-1 rounded-full text-xs font-bold shadow-lg",children:"⭐ FEATURED"})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3 flex-wrap",children:[t.verified&&e.jsx("span",{className:"bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold",children:"✓ VERIFIED"}),t.englishFluency&&e.jsxs("span",{className:"bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-semibold uppercase",children:[t.englishFluency," English"]})]}),e.jsx("h3",{className:"text-xl font-bold text-[var(--brand-dark)] mb-2",children:t.name}),!p&&s&&e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsxs("div",{className:"relative",onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:[e.jsx(m,{to:`/businesses/${t.id}`,className:"flex items-center gap-1 hover:opacity-80 transition-opacity",title:`${s.avgRating.toFixed(1)} out of 5 stars`,children:[...Array(5)].map((d,r)=>e.jsx(F,{className:`w-4 h-4 ${r<Math.round(s.avgRating)?"text-yellow-400 fill-yellow-400":"text-gray-300"}`},r))}),v&&s.count>0&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-xl p-4 z-50 w-64",children:[e.jsxs("div",{className:"text-sm font-semibold text-gray-700 mb-2",children:[s.avgRating.toFixed(1)," out of 5 stars"]}),e.jsxs("div",{className:"text-xs text-gray-500 mb-3",children:[s.count," ",s.count===1?"rating":"ratings"]}),e.jsx(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline text-sm font-medium",children:"See all reviews →"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:s.count>0?s.avgRating.toFixed(1):"0.0"}),s.count>0?e.jsxs(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline",children:["(",s.count," ",s.count===1?"review":"reviews",")"]}):e.jsx(m,{to:`/businesses/${t.id}#reviews`,className:"text-[var(--brand-primary)] hover:underline",children:"(Be the first to review!)"})]})]}),e.jsxs("div",{className:"flex items-start gap-2 mb-3 text-sm text-gray-600",children:[e.jsx(U,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.location}),t.baseDistance&&e.jsx("p",{className:"text-[var(--brand-primary)] text-xs",children:t.baseDistance})]})]}),e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-3",children:t.description}),e.jsxs("div",{className:"space-y-2 mb-4 text-sm",children:[t.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-[var(--brand-primary)]"}),e.jsx("a",{href:`tel:${t.phone}`,className:"text-[var(--brand-primary)] hover:underline",children:t.phone})]}),t.website&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-[var(--brand-primary)]"}),e.jsx("a",{href:t.website,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--brand-primary)] hover:underline truncate",children:"Visit Website"})]})]}),n&&e.jsx("div",{className:"rounded-lg overflow-hidden mb-4",children:e.jsx(C,{center:[t.latitude,t.longitude],zoom:14,height:"h-40",markers:[{position:[t.latitude,t.longitude],title:t.name}]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{to:`/businesses/${t.id}`,className:"flex-1 text-center bg-[var(--brand-primary)] text-white py-2 px-4 rounded-lg hover:bg-[var(--brand-dark)] transition font-semibold text-sm",children:"View Details"}),x&&e.jsx("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"bg-[var(--brand-gold)] text-[var(--brand-dark)] p-2 rounded-lg hover:bg-yellow-400 transition",title:"Get Directions",children:e.jsx(T,{className:"w-5 h-5"})})]})]})]})}const V={automotive:"Automotive Services",healthcare:"Healthcare",restaurants:"Restaurants & Dining",shopping:"Shopping","home-services":"Home Services","real-estate":"Real Estate",legal:"Legal Services",education:"Education",business:"Business Services"},u={automotive:["car-dealerships","mechanics","inspection-stations","auto-parts"],healthcare:["general-practitioners","dentists","specialists","pharmacies","veterinary-services"],restaurants:["american-food","international","cafes"]};function K(){const{selectedBase:t}=B(),{category:i}=N(),s=k(),{data:o=[],isLoading:p,error:g,refetch:v}=E(),c=h.useMemo(()=>{if(!i||!o.length)return[];const r=t||"all";return o.filter(a=>a.category===i&&(r==="all"||a.basesServed?.includes(r)))},[o,i,t]);if(p)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx(R,{size:"lg",message:"Loading businesses..."})});if(g)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--brand-bg)]",children:e.jsx(L,{title:"Failed to load businesses",message:g.message,onRetry:()=>v(),fullScreen:!0})});const f=i&&V[i]||"Services",x=D(t),n={};c.forEach(r=>{const a=r.subcategory||"other";n[a]||(n[a]=[]),n[a].push(r)}),Object.keys(n).forEach(r=>{n[r].sort((a,l)=>a.featured&&!l.featured?-1:!a.featured&&l.featured?1:a.name.localeCompare(l.name))});const d=i&&u[i]?[...u[i],...Object.keys(n).filter(r=>!u[i].includes(r)).sort()]:Object.keys(n).sort();return e.jsxs("div",{className:"min-h-screen bg-[var(--brand-bg)]",children:[e.jsx("div",{className:"bg-[var(--brand-primary)] py-4 sticky top-16 z-50 shadow-md",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx(M,{})})}),e.jsx("div",{className:"py-12 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("button",{onClick:()=>s("/",{state:{scrollTo:"services"}}),className:"flex items-center gap-2 text-[var(--brand-primary)] hover:text-[var(--brand-dark)] mb-8 font-medium mt-8",children:[e.jsx(z,{className:"w-4 h-4"}),"Back to All Services"]}),e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-[var(--brand-dark)] mb-4",children:f}),e.jsxs("p",{className:"text-lg text-[var(--brand-dark)] opacity-80",children:[c.length," ",c.length===1?"business":"businesses"," ","near ",x?.name||"your base"]})]}),d.filter(r=>n[r]?.length>0).length>1&&e.jsx("div",{className:"sticky top-[72px] z-30 bg-white/95 backdrop-blur-sm border-y border-gray-200 -mx-4 px-4 py-4 mb-8 shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide",children:[e.jsx("span",{className:"text-sm font-semibold text-[var(--brand-dark)] whitespace-nowrap mr-2",children:"Jump to:"}),d.map(r=>{const a=n[r];return!a||a.length===0?null:e.jsxs("button",{onClick:()=>{const l=document.getElementById(`subcategory-${r}`);if(l){const w=l.getBoundingClientRect().top+window.pageYOffset-150;window.scrollTo({top:w,behavior:"smooth"})}},className:"bg-[var(--brand-primary)] text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-[var(--brand-dark)] transition whitespace-nowrap flex-shrink-0",children:[j(r),e.jsxs("span",{className:"ml-1.5 opacity-75",children:["(",a.length,")"]})]},r)})]})}),d.length>0?e.jsx("div",{className:"space-y-12",children:d.map(r=>{const a=n[r];return!a||a.length===0?null:e.jsxs("div",{id:`subcategory-${r}`,children:[(r!=="other"||d.length>1)&&e.jsx("h2",{className:"text-2xl font-bold text-[var(--brand-dark)] mb-6 border-b-2 border-[var(--brand-primary)] pb-2",children:j(r)}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(l=>e.jsx(A,{business:l,featured:l.featured||!1},l.id))})]},r)})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsxs("p",{className:"text-[var(--brand-dark)] opacity-60 mb-4",children:["No businesses found in this category yet for ",x?.name,"."]}),e.jsx(m,{to:"/",className:"inline-block bg-[var(--brand-primary)] text-white px-6 py-3 rounded-lg hover:bg-[var(--brand-dark)] transition font-semibold",children:"Browse Other Categories"})]})]})})]})}export{K as default};
