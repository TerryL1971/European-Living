import{s as g}from"./index-DQ5WlURG.js";import{j as d}from"./vendor-markdown-BC8sZGMk.js";import{r as m}from"./vendor-react-BDu5rya1.js";function p(t){const e=t,s=t;if(typeof s.tags=="string")try{const r=s.tags.trim();r.startsWith("{")&&r.endsWith("}")?e.tags=r.slice(1,-1).split(",").map(c=>c.trim().replace(/^"|"$/g,"")).filter(Boolean):e.tags=JSON.parse(r)}catch{console.warn("Could not parse tags string, defaulting to empty array:",s.tags),e.tags=[]}else Array.isArray(s.tags)||(e.tags=[]);return e}async function E(t){let e=g.from("articles").select("*").order("created_at",{ascending:!1});t?.category&&(e=e.eq("category",t.category)),t?.destination&&(e=e.eq("destination_name",t.destination)),t?.tag&&(e=e.contains("tags",[t.tag])),t?.published!==void 0&&(e=e.eq("published",t.published)),t?.limit&&(e=e.limit(t.limit)),t?.offset&&(e=e.range(t.offset,t.offset+(t.limit||10)-1));const{data:s,error:r}=await e;if(r)throw console.error("Error fetching articles:",r),r;return s.map(p)}async function A(t){const{data:e,error:s}=await g.from("articles").select("*").eq("slug",t).eq("published",!0).single();if(s){if(s.code==="PGRST116")return null;throw console.error("Error fetching article:",s),s}const r=p(e);return b(r.id),r}async function b(t){try{await g.rpc("increment_article_views",{article_id:t})}catch(e){console.warn("RPC increment_article_views failed, using fallback:",e.message);const{data:r}=await g.from("articles").select("view_count").eq("id",t).single();r&&await g.from("articles").update({view_count:r.view_count+1}).eq("id",t).select()}}async function S(t,e,s,r=3){let c=g.from("articles").select("*").eq("published",!0).neq("id",t).limit(r);e&&(c=c.eq("category",e));const{data:f,error:o}=await c;if(o)throw console.error("Error fetching related articles:",o),o;return f.map(p)}function T({content:t}){const[e,s]=m.useState([]),[r,c]=m.useState("");m.useEffect(()=>{const o=/^(#{2,3})\s+(.+)$/gm,i=[],a=new Set;let n;const y=h=>{const u=h.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-");let l=u,w=1;for(;a.has(l);)l=`${u}-${w}`,w++;return a.add(l),l};for(;(n=o.exec(t))!==null;){const h=n[1].length,u=n[2].trim(),l=y(u);i.push({id:l,text:u,level:h})}s(i),console.log("TOC items generated:",i)},[t]),m.useEffect(()=>{const o=new IntersectionObserver(a=>{a.forEach(n=>{n.isIntersecting&&c(n.target.id)})},{rootMargin:"-80px 0px -80% 0px"});return document.querySelectorAll("h2, h3").forEach(a=>{a.id&&o.observe(a)}),()=>o.disconnect()},[e]);const f=o=>{console.log("Trying to scroll to:",o);const i=document.getElementById(o);if(console.log("Found element:",i),i)i.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{window.scrollBy({top:-100,behavior:"smooth"})},100);else{console.error("Element not found with id:",o);const a=document.querySelectorAll("h2, h3");console.log("All heading IDs:",Array.from(a).map(n=>({id:n.id,text:n.textContent})))}};return e.length===0?null:d.jsxs("div",{className:"sticky top-24 bg-white rounded-lg shadow-md p-4 max-h-[calc(100vh-8rem)] overflow-y-auto border border-gray-200",children:[d.jsx("h3",{className:"text-lg font-bold text-[var(--brand-dark)] mb-3",children:"Table of Contents"}),d.jsx("nav",{children:d.jsx("ul",{className:"space-y-2",children:e.map(o=>d.jsx("li",{className:o.level===3?"ml-4":"",children:d.jsx("button",{onClick:()=>f(o.id),className:`text-left w-full text-sm hover:text-[var(--brand-primary)] transition-colors ${r===o.id?"text-[var(--brand-primary)] font-semibold":"text-[var(--brand-dark)] opacity-70"}`,children:o.text})},o.id))})})]})}export{T,S as a,E as b,A as g};
